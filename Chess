//Anna Lu and Ivan Zheng

package chess;

import java.util.ArrayList;
import java.util.List;

public class Chess {
    private Board board;
    private Player currentPlayer;

    public Chess() {
        this.board = new Board();
        this.currentPlayer = Player.white;
    }

    public void start() {
        this.board = new Board(); // Reset the board to the initial state
        this.currentPlayer = Player.white; // White starts first
    }

    public ReturnPlay play(String move) {
        ReturnPlay result = new ReturnPlay();
        result.piecesOnBoard = new ArrayList<>();

        // Parse the move
        String[] parts = move.trim().split(" ");
        String from = parts[0];
        String to = parts[1];

        // Validate the move
        if (!board.isValidMove(from, to, currentPlayer)) {
            result.message = Message.ILLEGAL_MOVE;
            result.piecesOnBoard = board.getPieces(); // Return the current board state
            return result;
        }

        // Execute the move
        board.movePiece(from, to);

        // Check for checkmate or check
        if (board.isCheckmate(Player.black)) {
            result.message = Message.CHECKMATE_WHITE_WINS;
        } else if (board.isCheckmate(Player.white)) {
            result.message = Message.CHECKMATE_BLACK_WINS;
        } else if (board.isCheck(currentPlayer)) {
            result.message = Message.CHECK;
        } else {
            result.message = null; // No special message
        }

        // Update the board state
        result.piecesOnBoard = board.getPieces();

        // Switch players
        currentPlayer = (currentPlayer == Player.white) ? Player.black : Player.white;

        return result;
    }
}